<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>WebSocket Test</title>
  </head>
  <body>
    <h1>Chat WebSocket</h1>
    <input type="text" id="userId" placeholder="ID do usuário" />
    <input type="text" id="pergunta" placeholder="Sua pergunta" />
    <select id="publico">
      <option value="PROFESSOR">Professor</option>
      <option value="CUIDADOR">Cuidador</option>
      <option value="RESPONSAVEL">Responsável</option>
      <option value="USUARIO">Pessoa com TEA</option>
      <option value="TEA_NIVEL_1">Pessoa com TEA - Nível 1</option>
      <option value="TEA_NIVEL_2">Pessoa com TEA - Nível 2</option>
      <option value="TEA_NIVEL_3">Pessoa com TEA - Nível 3</option>
    </select>
    <button onclick="enviarMensagem()">Enviar</button>

    <h2>Resposta:</h2>
    <pre id="resposta"></pre>

    <script>
      const protocol = location.protocol === "https:" ? "wss" : "ws";
      const host = location.host;
      const socket = new WebSocket(`${protocol}://${host}`);

      socket.onmessage = function (event) {
        const data = JSON.parse(event.data);

        if (data.error) {
          document.getElementById("resposta").textContent =
            "Erro: " + data.error;
        } else {
          document.getElementById("resposta").textContent = data.content;
        }
      };

      function enviarMensagem() {
        const userId = document.getElementById("userId").value;
        const pergunta = document.getElementById("pergunta").value;
        const publico = document.getElementById("publico").value;

        const mensagem = {
          userId,
          pergunta,
          publico,
        };

        console.log("Mensagem enviada:", JSON.stringify(mensagem));

        socket.send(JSON.stringify(mensagem));
      }
    </script>
  </body>
</html>
